{% extends "layout.html" %}

{% block title %}
My Bibliography Manager
{% endblock %}

{% block body %}
<div style="display: flex; justify-content: space-between; align-items: center; padding: 10px;">
  <h2>My Bibliography Manager</h2>
  <button 
    onclick="toggleTheme()" 
    style="padding: 8px 16px; background-color: #2196F3; color: white; border: none; border-radius: 4px; cursor: pointer;"
  >
    <span id="theme-icon">ðŸŒ™</span> Toggle Theme
  </button>
</div>

<div>
  <p>Manage your scientific references with ease. Select your preferred input method below.</p>
</div>

<div style="display: flex; gap: 40px; margin-top: 20px;">
  <!-- Left Column - Input Forms -->
  <div style="flex: 0 0 400px;">
    <form action="/create_reference" method="post" id="referenceForm">
      <!-- DOI Section -->
      <details style="margin-bottom: 20px; border: 1px solid #ddd; border-radius: 4px; padding: 10px;">
        <summary style="cursor: pointer; padding: 8px; font-weight: 400; user-select: none; " name="add_by_doi">
          Option 1: Add by DOI
        </summary>
        <div style="margin-top: 15px;">
          <label for="doi">DOI:</label><br>
          <input 
            type="text" 
            id="doi" 
            name="doi" 
            placeholder="Enter the DOI here..." 
            style="width: 300px; padding: 8px; margin-top: 5px;"
          >
        </div>
      </details>

      <!-- Article Section -->
      <details style="margin-bottom: 20px; border: 1px solid #ddd; border-radius: 4px; padding: 10px;">
        <summary style="cursor: pointer; padding: 8px; font-weight: 400; user-select: none;" name="add_article">
          Option 2: Add Article
        </summary>
        <div style="margin-top: 15px;">
          <label for="article_author">Author:</label><br>
          <input 
            type="text" 
            id="article_author" 
            name="article_author" 
            placeholder="Enter the author(s) here..." 
            style="width: 300px; padding: 8px; margin-top: 5px;"
          >
          <br><br>
          <label for="article_title">Title:</label><br>
          <input 
            type="text" 
            id="article_title" 
            name="article_title" 
            placeholder="Enter the title here..." 
            style="width: 300px; padding: 8px; margin-top: 5px;"
          >
          <br><br>
          <label for="article_journal">Journal:</label><br>
          <input 
            type="text" 
            id="article_journal" 
            name="article_journal" 
            placeholder="Enter the journal name..." 
            style="width: 300px; padding: 8px; margin-top: 5px;"
          >
          <br><br>
          <label for="article_year">Year:</label><br>
          <input 
            type="number" 
            id="article_year" 
            name="article_year" 
            placeholder="Enter publication year..." 
            min="1800"
            max="2024"
            style="width: 300px; padding: 8px; margin-top: 5px;"
          >
        </div>
      </details>

      <!-- Inproceedings Section -->
      <details style="margin-bottom: 20px; border: 1px solid #ddd; border-radius: 4px; padding: 10px;">
        <summary style="cursor: pointer; padding: 8px; font-weight: 400; user-select: none;" name="add_conference_paper">
          Option 3: Add Conference Paper
        </summary>
        <div style="margin-top: 15px;">
          <label for="inproceeding_author">Author:</label><br>
          <input 
            type="text" 
            id="inproceeding_author" 
            name="inproceeding_author" 
            placeholder="Enter the author(s) here..." 
            style="width: 300px; padding: 8px; margin-top: 5px;"
          >
          <br><br>
          <label for="inproceeding_title">Title:</label><br>
          <input 
            type="text" 
            id="inproceeding_title" 
            name="inproceeding_title" 
            placeholder="Enter the title here..." 
            style="width: 300px; padding: 8px; margin-top: 5px;"
          >
          <br><br>
          <label for="inproceeding_book_title">Book Title (Conference Proceedings):</label><br>
          <input 
            type="text" 
            id="inproceeding_book_title" 
            name="inproceeding_book_title" 
            placeholder="Enter the conference proceedings name..." 
            style="width: 300px; padding: 8px; margin-top: 5px;"
          >
          <br><br>
          <label for="inproceeding_year">Year:</label><br>
          <input 
            type="number" 
            id="inproceeding_year" 
            name="inproceeding_year" 
            placeholder="Enter publication year..." 
            min="1800"
            max="2024"
            style="width: 300px; padding: 8px; margin-top: 5px;"
          >
        </div>
      </details>

      <!-- Book Section -->
      <details style="border: 1px solid #ddd; border-radius: 4px; padding: 10px;">
        <summary style="cursor: pointer; padding: 8px; font-weight: 400; user-select: none;" name="add_book">
          Option 4: Add Book
        </summary>
        <div style="margin-top: 15px;">
          <label for="book_author">Author:</label><br>
          <input 
            type="text" 
            id="book_author" 
            name="book_author" 
            placeholder="Enter the author(s) here..." 
            style="width: 300px; padding: 8px; margin-top: 5px;"
          >
          <br><br>
          <label for="book_title">Title:</label><br>
          <input 
            type="text" 
            id="book_title" 
            name="book_title" 
            placeholder="Enter the title here..." 
            style="width: 300px; padding: 8px; margin-top: 5px;"
          >
          <br><br>
          <label for="book_book_title">Book_Title:</label><br>
          <input 
            type="text" 
            id="book_book_title" 
            name="book_book_title" 
            placeholder="Enter the title here..." 
            style="width: 300px; padding: 8px; margin-top: 5px;"
          >
          <br><br>
          <label for="book_publisher">Publisher:</label><br>
          <input 
            type="text" 
            id="book_publisher" 
            name="book_publisher" 
            placeholder="Enter the publisher name..." 
            style="width: 300px; padding: 8px; margin-top: 5px;"
          >
          <br><br>
          <label for="book_year">Year:</label><br>
          <input 
            type="number" 
            id="book_year" 
            name="book_year" 
            placeholder="Enter publication year..." 
            min="1800"
            max="2024"
            style="width: 300px; padding: 8px; margin-top: 5px;"
          >
        </div>
      </details>
      <div style="margin-top: 20px; margin-left: 10px; display: flex; gap: 10px;">
        <button 
          type="submit" 
          style="padding: 8px 16px; background-color: #60a060; color: white; border: none; border-radius: 4px; cursor: pointer;"
          onclick="return true"
        >
          Add Reference
        </button>
        <button 
          type="button"
          onclick="exportAllBibTeX()"
          style="padding: 8px 16px; background-color: #2196F3; color: white; border: none; border-radius: 4px; cursor: pointer;"
        >
          Export BibTeX
        </button>
      </div>
    </form>
  </div>

<!-- Middle Column - Display References -->
  <div style="flex: 1; max-width: 800px;">
    <div style="margin-top: 30px;">
      <h3>Articles:</h3>
      <ul style="list-style: none; padding: 0;">
        {% for article in articles %}
          <li id="reference-article-{{article.id}}"
              data-doi="{{article.article}}"
              style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; padding: 10px; border: 1px solid #ddd; border-radius: 4px;">
            <span>{{article}}</span>
            <div>
              <button onclick="editReference('article', {{article.id}})" style="padding: 5px 10px; margin-right: 5px; background-color: #4CAF50; color: white; border: none; border-radius: 4px; cursor: pointer;">Edit</button>
              <button onclick="deleteReference('article', {{article.id}})" style="padding: 5px 10px; background-color: #f44336; color: white; border: none; border-radius: 4px; cursor: pointer;">Delete</button>
              <button onclick="viewBibTeX('article', {{article.id}})" style="padding: 5px 10px; background-color: #2196F3; color: white; border: none; border-radius: 4px; cursor: pointer;">BibTeX</button>
            </div>
          </li>
        {% endfor %}
      </ul>

      <!-- Repeat similar structure for other reference types -->
      <h3>Conference Papers:</h3>
      <ul style="list-style: none; padding: 0;">
        {% for inproceeding in inproceedings %}
          <li id="reference-inproceeding-{{inproceeding.id}}"
              data-doi="{{inproceeding.inproceeding}}"
              style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; padding: 10px; border: 1px solid #ddd; border-radius: 4px;">
            <span>{{inproceeding}}</span>
            <div>
              <button onclick="editReference('inproceeding', {{inproceeding.id}})" style="padding: 5px 10px; margin-right: 5px; background-color: #4CAF50; color: white; border: none; border-radius: 4px; cursor: pointer;">Edit</button>
              <button onclick="deleteReference('inproceeding', {{inproceeding.id}})" style="padding: 5px 10px; background-color: #f44336; color: white; border: none; border-radius: 4px; cursor: pointer;">Delete</button>
              <button onclick="viewBibTeX('inproceeding', {{inproceeding.id}})" style="padding: 5px 10px; background-color: #2196F3; color: white; border: none; border-radius: 4px; cursor: pointer;">BibTeX</button>
            </div>
          </li>
        {% endfor %}
      </ul>

      <h3>Books:</h3>
      <ul style="list-style: none; padding: 0;">
        {% for book in books %}
          <li id="reference-book-{{book.id}}"
              data-doi="{{book.book}}"
              style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; padding: 10px; border: 1px solid #ddd; border-radius: 4px;">
            <span>{{book}}</span>
            <div>
              <button onclick="editReference('book', {{book.id}})" style="padding: 5px 10px; margin-right: 5px; background-color: #4CAF50; color: white; border: none; border-radius: 4px; cursor: pointer;">Edit</button>
              <button onclick="deleteReference('book', {{book.id}})" style="padding: 5px 10px; background-color: #f44336; color: white; border: none; border-radius: 4px; cursor: pointer;">Delete</button>
              <button onclick="viewBibTeX('book', {{book.id}})" style="padding: 5px 10px; background-color: #2196F3; color: white; border: none; border-radius: 4px; cursor: pointer;">BibTeX</button>
            </div>
          </li>
        {% endfor %}
      </ul>

      <h3>DOIs:</h3>
      <ul style="list-style: none; padding: 0;">
        {% for doi in dois %}
          <li id="reference-doi-{{doi.id}}"
              data-doi="{{doi.doi}}"
              style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; padding: 10px; border: 1px solid #ddd; border-radius: 4px;">
            <span>{{doi}}</span>
            <div>
              <button onclick="editReference('doi', {{doi.id}})" style="padding: 5px 10px; margin-right: 5px; background-color: #4CAF50; color: white; border: none; border-radius: 4px; cursor: pointer;">Edit</button>
              <button onclick="deleteReference('doi', {{doi.id}})" style="padding: 5px 10px; background-color: #f44336; color: white; border: none; border-radius: 4px; cursor: pointer;">Delete</button>
              <button onclick="viewBibTeX('doi', {{doi.id}})" style="padding: 5px 10px; background-color: #2196F3; color: white; border: none; border-radius: 4px; cursor: pointer;">BibTeX</button>
            </div>
          </li>
        {% endfor %}
      </ul>

    </div>
  </div>

  <!-- Right Column - BibTeX Display -->
  <div id="bibtexDisplay" style="flex: 0 0 400px; display: none;" data-current-ref="">
    <div style="position: sticky; top: 20px;">
      <h3>BibTeX Entry</h3>
      <pre id="bibtexContent" style="white-space: pre-wrap; background-color: #f5f5f5; padding: 15px; border-radius: 4px; border: 1px solid #ddd;"></pre>
      <button 
        onclick="copyBibTeX()" 
        style="margin-top: 10px; padding: 8px 16px; background-color: #2196F3; color: white; border: none; border-radius: 4px; cursor: pointer; display: flex; align-items: center; gap: 5px;">
        <span>Copy to Clipboard</span>
      </button>
    </div>
  </div>
</div>


{% endblock %}